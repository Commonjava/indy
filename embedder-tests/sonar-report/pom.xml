<?xml version="1.0" encoding="UTF-8"?>
<!--

    Copyright (C) 2011-2023 Red Hat, Inc. (https://github.com/Commonjava/indy)

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

            http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <parent>
    <artifactId>indy-embedder-tests</artifactId>
    <groupId>org.commonjava.indy.embed.test</groupId>
    <version>3.5.0-SNAPSHOT</version>
  </parent>
  <modelVersion>4.0.0</modelVersion>

  <artifactId>indy-embedder-sonar-report</artifactId>
  <description>Embedder-tests report for sonar(ftests)</description>

  <name>Indy :: Embedder-Tests :: Sonar Report</name>

  <properties>
    <test.reports.dir>${project.build.directory}/test-reports</test.reports.dir>
    <sonar.skip>true</sonar.skip>
  </properties>

  <dependencies>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-bindings-jaxrs</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-api</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-core</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy.service</groupId>
      <artifactId>indy-model-core-java</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-subsys-groovy</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-subsys-infinispan</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-subsys-cassandra</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-subsys-keycloak</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-subsys-metrics</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-subsys-jaxrs</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-subsys-flatfile</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-subsys-http</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-filer-default</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-db-common</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-db-memory</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy.boot</groupId>
      <artifactId>indy-booter-jaxrs</artifactId>
    </dependency>

    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-diagnostics-jaxrs</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-diagnostics-common</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-httprox-common</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-pkg-maven-common</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-pkg-maven-jaxrs</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-pkg-npm-jaxrs</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-pkg-npm-common</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-pkg-npm-model-java</artifactId>
    </dependency>

    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-folo-jaxrs</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-folo-common</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-koji-jaxrs</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-koji-common</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-test-db</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-test-fixtures-core</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-test-utils</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-path-mapped-common</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-path-mapped-model-java</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-path-mapped-jaxrs</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.auditquery</groupId>
      <artifactId>auditquery-api</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.auditquery</groupId>
      <artifactId>auditquery-model-java</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-repo-proxy-common</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-repo-proxy-jaxrs</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-schedule-common</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-schedule-model-java</artifactId>
    </dependency>

    <!--
    <dependency>
      <groupId>org.commonjava.atlas</groupId>
      <artifactId>atlas-identities</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.atlas</groupId>
      <artifactId>atlas-relationships-api</artifactId>
    </dependency>
    <dependency>
      <groupId>org.infinispan</groupId>
      <artifactId>infinispan-commons</artifactId>
    </dependency>
    <dependency>
      <groupId>org.infinispan</groupId>
      <artifactId>infinispan-core</artifactId>
    </dependency>
    <dependency>
      <groupId>org.infinispan</groupId>
      <artifactId>infinispan-cdi-embedded</artifactId>
    </dependency>
    <dependency>
      <groupId>org.infinispan</groupId>
      <artifactId>infinispan-query</artifactId>
    </dependency>

    <dependency>
      <groupId>org.hibernate</groupId>
      <artifactId>hibernate-search-orm</artifactId>
    </dependency>
    <dependency>
      <groupId>javax.cache</groupId>
      <artifactId>cache-api</artifactId>
    </dependency>
    <dependency>
      <groupId>org.keycloak</groupId>
      <artifactId>keycloak-undertow-adapter</artifactId>
    </dependency>
    <dependency>
      <groupId>org.keycloak</groupId>
      <artifactId>keycloak-core</artifactId>
    </dependency>
    <dependency>
      <groupId>org.keycloak</groupId>
      <artifactId>keycloak-adapter-core</artifactId>
    </dependency>
    <dependency>
      <groupId>args4j</groupId>
      <artifactId>args4j</artifactId>
    </dependency>
    <dependency>
      <groupId>org.jboss.weld.se</groupId>
      <artifactId>weld-se-shaded</artifactId>
    </dependency>
    -->

    <!-- Tests -->
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-ftests-core</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-ftests-common</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-ftests-httprox</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-ftests-diagnostics</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-ftests-pkg-maven</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-ftests-pkg-npm</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-ftests-folo</artifactId>
    </dependency>
    <dependency>
      <groupId>org.commonjava.indy</groupId>
      <artifactId>indy-ftests-repo-proxy</artifactId>
    </dependency>
    <!-- Tests -->
  </dependencies>

  <build>
    <plugins>
      <!--clean src/main/java and src/test/java as it is just a temp source folder for reporting-->
      <plugin>
        <artifactId>maven-clean-plugin</artifactId>
        <executions>
          <execution>
            <id>clean-copy</id>
            <phase>clean</phase>
            <goals>
              <goal>clean</goal>
            </goals>
            <configuration>
              <filesets>
                <fileset>
                  <directory>${project.build.sourceDirectory}</directory>
                </fileset>
                <fileset>
                  <directory>${project.build.testSourceDirectory}</directory>
                </fileset>
              </filesets>
            </configuration>
          </execution>
        </executions>
      </plugin>
      <!-- bypass compile phase as no compile action needed -->
      <plugin>
        <artifactId>maven-compiler-plugin</artifactId>
        <executions>
          <execution>
            <id>default-compile</id>
            <phase>compile</phase>
            <goals>
              <goal>compile</goal>
            </goals>
            <configuration>
              <skipMain>true</skipMain>
            </configuration>
          </execution>
          <execution>
            <id>default-testCompile</id>
            <phase>test-compile</phase>
            <goals>
              <goal>testCompile</goal>
            </goals>
            <configuration>
              <skip>true</skip>
            </configuration>
          </execution>
        </executions>
      </plugin>
      <!-- bypass unit test phase as no unit test needed -->
      <plugin>
        <artifactId>maven-surefire-plugin</artifactId>
        <configuration>
          <skipTests>true</skipTests>
        </configuration>
      </plugin>

      <plugin>
        <artifactId>maven-dependency-plugin</artifactId>
        <version>2.8</version>
        <executions>
          <execution>
            <id>unpack-sources</id>
            <phase>post-integration-test</phase>
            <goals>
              <goal>unpack-dependencies</goal>
            </goals>
            <configuration>
              <outputDirectory>${project.build.sourceDirectory}</outputDirectory>
              <includeGroupIds>
                org.commonjava.indy,
                org.commonjava.indy.boot
              </includeGroupIds>
              <excludeArtifactIds>
                indy-test-db,
                indy-test-utils,
                indy-ftests-core,
                indy-ftests-common,
                indy-ftests-folo,
                indy-ftests-httprox,
                indy-ftests-diagnostics,
                indy-ftests-pkg-maven,
                indy-ftests-pkg-npm,
                indy-ftests-koji,
                indy-ftests-repo-proxy
              </excludeArtifactIds>
              <classifier>sources</classifier>
              <includes>**/*.java</includes>
              <overWriteReleases>false</overWriteReleases>
              <overWriteSnapshots>true</overWriteSnapshots>
            </configuration>
          </execution>
          <execution>
            <id>unpack-classes</id>
            <phase>post-integration-test</phase>
            <goals>
              <goal>unpack-dependencies</goal>
            </goals>
            <configuration>
              <outputDirectory>${project.build.outputDirectory}</outputDirectory>
              <includeGroupIds>
                org.commonjava.indy,
                org.commonjava.indy.boot
              </includeGroupIds>
              <excludeArtifactIds>
                indy-test-db,
                indy-test-utils,
                indy-ftests-core,
                indy-ftests-common,
                indy-ftests-folo,
                indy-ftests-httprox,
                indy-ftests-diagnostics,
                indy-ftests-pkg-maven,
                indy-ftests-pkg-npm,
                indy-ftests-koji,
                indy-ftests-repo-proxy
              </excludeArtifactIds>
              <includes>**/*.class</includes>
              <overWriteReleases>false</overWriteReleases>
              <overWriteSnapshots>true</overWriteSnapshots>
            </configuration>
          </execution>
          <execution>
            <id>unpack-test-sources</id>
            <phase>post-integration-test</phase>
            <goals>
              <goal>unpack-dependencies</goal>
            </goals>
            <configuration>
              <outputDirectory>${project.build.testSourceDirectory}</outputDirectory>
              <includeGroupIds>
                org.commonjava.indy,
                org.commonjava.indy.boot
              </includeGroupIds>
              <classifier>test-sources</classifier>
              <includes>**/*.java</includes>
              <overWriteReleases>false</overWriteReleases>
              <overWriteSnapshots>true</overWriteSnapshots>
            </configuration>
          </execution>
          <execution>
            <id>unpack-test-classes</id>
            <phase>post-integration-test</phase>
            <goals>
              <goal>unpack-dependencies</goal>
            </goals>
            <configuration>
              <outputDirectory>${project.build.testOutputDirectory}</outputDirectory>
              <includeGroupIds>
                org.commonjava.indy,
                org.commonjava.indy.boot
              </includeGroupIds>
              <classifier>tests</classifier>
              <includes>**/*.class</includes>
              <overWriteReleases>false</overWriteReleases>
              <overWriteSnapshots>true</overWriteSnapshots>
            </configuration>
          </execution>
          <execution>
            <id>unpack-ftest-sources</id>
            <phase>post-integration-test</phase>
            <goals>
              <goal>unpack-dependencies</goal>
            </goals>
            <configuration>
              <outputDirectory>${project.build.testSourceDirectory}</outputDirectory>
              <includeArtifactIds>
                indy-test-db,
                indy-test-utils,
                indy-ftests-core,
                indy-ftests-common,
                indy-ftests-folo,
                indy-ftests-httprox,
                indy-ftests-diagnostics,
                indy-ftests-pkg-maven,
                indy-ftests-pkg-npm,
                indy-ftests-koji,
                indy-ftests-repo-proxy
              </includeArtifactIds>
              <classifier>sources</classifier>
              <includes>**/*.java</includes>
            </configuration>
          </execution>
          <execution>
            <id>unpack-ftest-classes</id>
            <phase>post-integration-test</phase>
            <goals>
              <goal>unpack-dependencies</goal>
            </goals>
            <configuration>
              <outputDirectory>${project.build.testOutputDirectory}</outputDirectory>
              <includeArtifactIds>
                indy-test-db,
                indy-test-utils,
                indy-ftests-core,
                indy-ftests-common,
                indy-ftests-folo,
                indy-ftests-httprox,
                indy-ftests-diagnostics,
                indy-ftests-pkg-maven,
                indy-ftests-pkg-npm,
                indy-ftests-koji,
                indy-ftests-repo-proxy
              </includeArtifactIds>
              <includes>**/*.class</includes>
            </configuration>
          </execution>
        </executions>
      </plugin>
      <plugin>
        <artifactId>maven-resources-plugin</artifactId>
        <executions>
          <!-- copy all test & ftest reports target/test-reports for sonar report -->
          <execution>
            <id>copy-test-reports</id>
            <phase>post-integration-test</phase>
            <goals>
              <goal>copy-resources</goal>
            </goals>
            <configuration>
              <outputDirectory>${test.reports.dir}</outputDirectory>
              <resources>
                <resource>
                  <directory>${junit.report.dir}</directory>
                  <include>**/*.xml</include>
                </resource>
                <resource>
                  <directory>${failsafe.report.dir}</directory>
                  <include>**/*.xml</include>
                </resource>
              </resources>
            </configuration>
          </execution>
        </executions>
      </plugin>
    </plugins>
  </build>

  <profiles>
    <profile>
      <id>sonar-test-report</id>
      <properties>
        <sonar.skip>false</sonar.skip>
        <sonar.projectKey>${project.groupId}:indy-sonar-report</sonar.projectKey>
        <sonar.projectName>Indy :: Overall Test coverage :: Sonar Report</sonar.projectName>
        <sonar.projectDescription>Assemble all Indy unit test and ftest against all codes, and do sonar reporting
        </sonar.projectDescription>
        <sonar.projectVersion>${project.version}</sonar.projectVersion>
        <sonar.links.homepage>http://github.com/Commonjava/indy</sonar.links.homepage>
        <sonar.links.scm>scm:git:https://github.com/Commonjava/indy.git</sonar.links.scm>
        <sonar.links.scm_dev>scm:git:git@github.com:Commonjava/indy.git</sonar.links.scm_dev>
        <sonar.sources>${project.build.sourceDirectory}</sonar.sources>
        <sonar.tests>${project.build.testSourceDirectory}</sonar.tests>
        <sonar.dynamicAnalysis>reuseReports</sonar.dynamicAnalysis>
        <sonar.jacoco.itReportPath>${project.basedir}/../../target/jacoco-merged.exec</sonar.jacoco.itReportPath>
        <sonar.junit.reportsPath>${test.reports.dir}</sonar.junit.reportsPath>
      </properties>
    </profile>
  </profiles>


</project>
